name: ğŸ’¼ portfolio_tracker

# è§¦å‘æ¡ä»¶
on:
  workflow_dispatch:         # æ”¯æŒåœ¨ Actions é¡µé¢æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è¿è¡Œ
  push:
    paths:
      - 'portfolio_tracker.py'               # è„šæœ¬å˜åŠ¨è‡ªåŠ¨è¿è¡Œ
      - '.github/workflows/portfolio_tracker.yml' # é…ç½®å˜åŠ¨è‡ªåŠ¨è¿è¡Œ
      - 'portfolio.csv'                       # è´¦æœ¬æ›´æ–°åè‡ªåŠ¨è¿è¡Œ
  schedule:
    - cron: '45 10 * * *'     # åŒ—äº¬æ—¶é—´ 18:45 è¿è¡Œ (10:45 UTC)
                              # æ­¤æ—¶æ—¥çº¿æ•°æ®å’Œæ‰«ææŠ¥å‘Šé€šå¸¸å·²æ›´æ–°å®Œæ¯•

# æƒé™è®¾ç½®ï¼šå…è®¸å·¥ä½œæµä¿®æ”¹ä»“åº“å†…å®¹
permissions:
  contents: write

jobs:
  track_portfolio:
    runs-on: ubuntu-latest    # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è™šæ‹Ÿç¯å¢ƒ
    
    steps:
      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1      # åªè·å–æœ€æ–°ç‰ˆæœ¬ä»¥æé«˜é€Ÿåº¦

      - name: ğŸ é…ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: âš™ï¸ å®‰è£…ä¾èµ–ç¯å¢ƒ
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy pytz

      - name: ğŸš€ æ‰§è¡ŒæŒä»“è·Ÿè¸ªç›‘æ§
        run: python portfolio_tracker.py

      - name: ğŸ’¾ è‡ªåŠ¨æäº¤ç›‘æ§æŠ¥å‘Š
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # æ£€æŸ¥ results ç›®å½•ä¸‹æ˜¯å¦æœ‰æ–°æŠ¥å‘Šç”Ÿæˆ
          git add results/æŒä»“ç›‘æ§æŠ¥å‘Š.csv
          
          # åªæœ‰åœ¨æ–‡ä»¶å†…å®¹ç¡®å®å‘ç”Ÿå˜åŒ–æ—¶æ‰æäº¤ï¼Œé¿å…æ— æ•ˆè®°å½•
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "ğŸ’¼ è‡ªåŠ¨å¤ç›˜ï¼šæ›´æ–°æŒä»“ç›ˆäºæŠ¥å‘Š $(date +'%Y-%m-%d %H:%M')"
            git push
          else
            echo "ä»Šæ—¥æŒä»“æ•°æ®æ— å˜åŠ¨ï¼Œè·³è¿‡æ›´æ–°ã€‚"
          fi
